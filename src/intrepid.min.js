!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t)}(this,function(t){"use strict";var e={array:function(t){return!!(t&&t.splice&&e.callable(t.splice))},arraylike:function(t){return!!(t&&t.length&&void 0!==t[0]||e.array(t)||e.arguments(t))},arguments:function(t){return!(!t||!e.number(t.length)||"[object Arguments]"!==Object.prototype.toString.call(t))},primitive:function(t){return"object"!=typeof t},primitiveObject:function(t){return"object"==typeof t&&!!t.valueOf&&"object"!=typeof t.valueOf()},object:function(t){return"object"==typeof t},callable:function(t){return!!(t&&t.call&&t.apply)},element:function(t){return!!t.getElementsByTagName}},n={walk:function t(n,r,i,s,a,o,c,h,u,f,l){var p,d,g;if(o||(o=0,u=!!s,c=[]),o&&r&&!1===(p=u?r.call(n,n,s,h,o,c,a,f,l):r.call(n,n,h,o,c,a,f)))return!1;if(n=f?f[h]:n,s=l?l[h]:s,d=i&&i.call?u?i.call(n,n,s,h,o,c,a,f,l):i.call(n,n,h,o,c,a,f):!0===i||i<o,!o||d)switch(!0){case e.array(n):for(h=0,g=n.length;h<g;h++)if(!1===t(n[h],r,i,s&&s[h],a,o+1,c.concat([h]),h,u,n,s))return!1;break;case e.object(n):for(h in n)if((!Object.prototype.hasOwnProperty||Object.prototype.hasOwnProperty.call(n,h))&&!1===t(n[h],r,i,s&&s[h],a,o+1,c.concat([h]),h,u,n,s))return!1}return p&&e.callable(p)&&p.call(),null},merge:function(t){return t},_createDerefFunction:function(t){return function(){return t.apply(this,arguments)}},_createAssignableObject:function(t){return e.primitive(t)||e.primitiveObject(t)?new(Object.getPrototypeOf(t).constructor)(t):e.callable(t)?this._createDerefFunction(t):e.array(t)?t.slice(0):Object.create(t)},_derefWithTemplate:function(){function t(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,t):this.stack=(new Error).stack}return t.prototype=new Error,function(e,n,r,i,s,a,o,c){if(void 0===n)throw new t("deref template incorrectly defined for "+s.join("."));try{c[r]=e.call?e.call(n,n):function(){return a.method(n)}()}catch(e){throw e instanceof t?e:new t(e+" : deref template incorrectly defined for "+s.join("."))}}}(),deref:function(t,e,r){var i=Object.create(t),s=this._createAssignableObject;return e&&n.walk(e,this._derefWithTemplate,!0,i,{method:r||s}),i},derefAssign:function(t,e){var n=this._createAssignableObject;return this.deref(t,e,function(t){return Object.assign(n(t),t)})}},r=function(){return r.instance.create.apply(r.instance,arguments)};return r.base={create:function(t){return this.prep.apply(Object.create(this),arguments)},prep:function(){return this},namespace:function(){return n.derefAssign(this,this.shared&&this.shared.namespaceTemplate)},extend:function(t){return Object.assign(Object.create(this),t||{})},proto:function(){return Object.getPrototypeOf(this)},config:function(t,e){if(!e)return this.namespace().config(!0===t?this:{},1);var n,r,i,s,a;if(t.endConfig||(t.endConfig=function(){return this},t.endConfig=t.endConfig.bind(this)),this.shared&&this.shared.configMethods)for(i=this.shared.configMethods,s=0,a=(n=Object.keys(i)).length,s;s<a;s++)t[r=n[s]]=function(t,e,n){return function(){return t.apply(e,arguments),n}}(this[r],this,t);if(this.helpers)for(i=this.helpers,s=0,a=(n=Object.keys(i)).length,s;s<a;s++)i[r=n[s]]&&i[r].config&&i[r].config(t,e+1);return t}},r.queryInterface=r.base.extend({shared:{segments:{}},prep:function(t){return this.i={},this.i.current=0,this.i.segments=this.process(t),this},__andList:function(){return[]},__orList:function(){return[]},process:function(t){throw new Error("This function should be overridden, and is responsible for returning an array of filter functions.")},reset:function(){return this.i.current=0,this},next:function(){if(this.i.current<this.i.segments.length){var t=this.i.segments[this.i.current];return this.i.current++,t}return null},length:function(){return this.i.segments?this.i.segments.length:0}}),function(t,e){e.base={extend:function(t){return Object.assign(Object.create(this),t||{})}},e.matcher=e.base.extend({}),e.directive=e.base.extend({}),e.combination=e.base.extend({create:function(){return this.prep.apply(Object.create(this),arguments)},prep:function(t){return this.i={},this.i.list=t,this},apply:function(t){for(var n,r=this.i.list,i=0,s=r.length;i<s;i++)n=r[i],e.directive.isPrototypeOf(n)?t.setDirective(n):e.matcher.isPrototypeOf(n)?t.setMatcher(n):e.combination.isPrototypeOf(n)?n.apply(t):t.setSegment(n);return this},each:function(t,e){for(var n=this.i.list,r=0,i=n.length;r<i;r++)t.call(e||this,n[r])},toString:function(){return"[QueryInterface combination( "+this.i.list+" )]"}}),t.isDirective=function(t){return e.directive.isPrototypeOf(t)},t.isMatcher=function(t){return e.matcher.isPrototypeOf(t)},t.isCombination=function(t){return e.combination.isPrototypeOf(t)},e.matchAnyAndNone=e.matcher.extend({toString:function(){return"[QI matchAnyAndNone]"}}),e.matchNext=e.matcher.extend({toString:function(){return"[QI matchNext]"}}),e.goDescend=e.directive.extend({toString:function(){return"[QI goDescend]"}}),e.goAscend=e.directive.extend({toString:function(){return"[QI goAscend]"}}),e.matchAny=e.combination.create([e.matchNext,function(t,e,n){return!0}]),e.matchParent=e.combination.create([e.goAscend,e.matchAny]),e.matchAncestor=e.combination.create([e.goAscend,e.matchAnyAndNone])}(r.queryInterface,r.queryInterface.shared.segments),r.dataHandlers=r.base.extend({shared:{handlers:{byName:{},byList:[],inOrder:[]},filtered:{byName:{},byList:[],inOrder:[]},namespaceTemplate:{shared:{handlers:{byName:{},byList:[],inOrder:[]},filtered:{byName:{},byList:[],inOrder:[]},namespaceTemplate:{},configMethods:{}}},configMethods:{dataHandlers:!0}},dataHandlers:function(t){var e=this.shared.filtered,n=this.shared.handlers;e.byName={},e.byList=[],e.inOrder=[],arguments.length>1?t=arguments:"string"==typeof arguments[0]&&(t=[arguments[0]]);var r,i,s,a,o=t;for(r=0,i=o.length;r<i;r++)(s=o[r])&&n.byName[s]&&(a=n.byName[s],e.byName[s]=a,e.byList.push(a),e.inOrder.push(a));return this},getHandlersOrderedByWeight:function(){var t=this.shared.handlers.byList.slice();t.length;return t.sort(function(t,e){return t.weight>e.weight?1:t.weight<e.weight?-1:0})},choose:function(t){var e,n=this.shared,r=n.filtered.inOrder||n.handlers.inOrder,i=0,s=r.length;for(i;i<s;i++)if((e=r[i]).obj.validation(t)>0)return e.obj;return e.obj},add:function(t,e,n){var i={name:t,weight:e,obj:n};return n.join=function(t,e,n){return new r.join(t,e,n)},this.shared.handlers.byName[t]=i,this.shared.handlers.byList.push(i),this.shared.handlers.inOrder=this.getHandlersOrderedByWeight(),this}}),r.join=function t(e,n,r){return this instanceof t?(this.shared.store.set(this,{from:e,by:n,to:r}),this):new t(e,n,r)},r.join.prototype.shared={store:new WeakMap},r.join.prototype.from=function(){return this.shared.store.get(this).from},r.join.prototype.by=function(){return this.shared.store.get(this).by},r.join.prototype.to=function(){return this.shared.store.get(this).to},r.join.prototype.join=function(t,e){return new r.join(this,t,e)},r.join.prototype.toString=function(){return"[ intrepid Join "+this.by()+" ]"},r.targetReference=r.base.extend({shared:{namespaceTemplate:{shared:{namespaceTemplate:{}},helpers:{dataHandlers:function(t){return t.namespace()}}}},helpers:{dataHandlers:r.dataHandlers,join:r.join},prep:function(t,e,n){return this.i={},t instanceof this.helpers.join?this.i.join=t:this.i.join=this.helpers.join(n,e,t),this.i.handler=this.helpers.dataHandlers.choose(this),this},attribute:function(){if(this.i.handler.hasAttributes(this)&&this.i.handler.hasAttribute(this,filter)){var t=this.i.handler.parent(this,filter);if(t)return this.create(t)}return null},attributes:function(){if(this.i.handler.hasAttributes(this)){var t=this.i.handler.children(this,filter);if(t&&t.length)return this.wrap(t)}return[]},children:function(t){if(this.i.handler.hasChildren(this)){var e=this.i.handler.children(this,t);if(e&&e.length)return this.wrap(e)}return[]},parent:function(t){if(this.i.handler.hasParent(this)){var e=this.i.handler.parent(this,t);if(e)return this.create(e)}return null},filter:function(t){return this.i.handler.filter(this,t)?this:null},test:function(){for(var t=this.get(),e=arguments,n=0,r=e.length;n<r;n++)if(e[n]&&e[n].call&&e[n](t))return!0;return!1},get:function(){return this.i.join.to()},getKey:function(){return this.i.join.by()},getParent:function(){return this.i.join.from()},joinChild:function(t,e){return this.i.join.join(t,e)},wrap:function(t){if(!t)return[];if(e.array(t)){for(var n=[],r=0,i=t.length;r<i;r++)n.push(this.wrapItem(t[r]));return n}return[this.wrapItem(t)]},wrapItem:function(t){return this.isPrototypeOf(t)?t:this.create(t)}}),r.uniqueList=r.base.extend({shared:{namespaceTemplate:{shared:{namespaceTemplate:{},config:{},configMethods:{}}},config:{comparisonEntity:function(t){return t}},configMethods:{comparisonEntity:!0}},create:function(){return this.prep.apply(Object.create(this),arguments)},prep:function(){return this.i={},this.i.items=[],this.i.comparisons={objects:new WeakMap,primitives:{keys:[],vals:[]}},this},push:function(t){var n=this.shared.config.comparisonEntity(t);n===t?-1===this.i.items.indexOf(t)&&this.i.items.push(t):e.primitive(n)?-1===this.i.comparisons.primitives.keys.indexOf(n)&&(this.i.comparisons.primitives.keys.push(n),this.i.comparisons.primitives.vals.push(this.i.items.length),this.i.items.push(t)):this.i.comparisons.objects.has(n)||(this.i.comparisons.objects.set(n,this.i.items.length),this.i.items.push(t))},get:function(t){return arguments.length?this.i.items[t]:this.i.items},comparisonEntity:function(t){return this.shared.config.comparisonEntity=t,this}}),r.cursorObject=r.base.extend({shared:{namespaceTemplate:{shared:{namespaceTemplate:{}},helpers:{targetReference:function(t){return t.namespace()}}},config:{allowDuplicates:!1},configMethods:{allowDuplicates:!0,disallowDuplicates:!0}},helpers:{targetReference:r.targetReference,uniqueList:r.uniqueList.config().comparisonEntity(function(t,e){return t||console.trace(),t.get()}).endConfig()},allowDuplicates:function(){return this.shared.config.allowDuplicates=!0,this},disallowDuplicates:function(){return this.shared.config.allowDuplicates=!1,this},prep:function(){return this.i={},this.i.targets,this},chain:function(){var t=this.create();return t.i.targets=this.i.targets,t},_createList:function(){return this.shared.config.allowDuplicates?[]:this.helpers.uniqueList.create()},empty:function(){return this.i.targets=[],this},target:function(t){return arguments.length?(this.i.targets=[this.helpers.targetReference.create(t)],this):this.i.targets},targets:function(t){return arguments.length?(this.helpers.uniqueList.isPrototypeOf(t)&&(t=t.get()),this.i.targets=this.helpers.targetReference.wrap(t),this):this.i.targets},children:function(t){var e,n,r,i,s,a,o=this._createList();for(n=0,r=(e=this.i.targets).length;n<r;n++)for(s=0,a=(i=e[n].children(t)).length;s<a;s++)o.push(i[s]);return this.create().targets(o)},parent:function(t){var e,n,r,i,s=this._createList();for(n=0,r=(e=this.i.targets).length;n<r;n++)(i=e[n].parent(t))&&s.push(i);return this.create().targets(s)},filter:function(t){var e,n,r,i,s=this._createList();for(n=0,r=(e=this.i.targets).length;n<r;n++)(i=e[n].filter(t))&&s.push(i);return this.create().targets(s)},get:function(t){return arguments.length?t<this.i.targets.length?this.i.targets[t].get():null:this.getArray()},getArray:function(){var t,e,n,r=[];for(e=0,n=(t=this.i.targets).length;e<n;e++)r.push(t[e].get());return r},add:function(t){return this.isPrototypeOf(t)&&(this.i.targets=this.i.targets.concat(t.i.targets)),this},length:function(){return this.i.targets?this.i.targets.length:0}}),r.instance=r.base.extend({shared:{namespaceTemplate:{shared:{namespaceTemplate:{}},helpers:{cursorObject:function(t){return t.namespace()}}}},helpers:{queryInterface:r.queryInterface,cursorObject:r.cursorObject},prep:function(t,e){return this.i={},this.prepCursor(t),this.prepChained(e),this},prepCursor:function(t){this.helpers.cursorObject.isPrototypeOf(t)?this.i.cursor=t:t&&(this.i.cursor=this.helpers.cursorObject.create().target(t))},prepChained:function(t){var e=this.i.chained=this.i.chained?n.derefAssign(this.i.chained):{};return e.handlers||(e.handlers=[]),e.stored||(e.stored=[]),e.options||(e.options={}),t&&n.merge(e.options,t),this},chain:function(t){return this.create(void 0!==t?t:this.i.cursor.chain())},extend:function(t){return Object.assign(Object.create(this),t||{}).prep(null)},options:function(){return arguments.length?(n.merge(this.i.chained.options,arguments[0]),this):this.chained.options},each:function(t,e){return this.i.cursor.each.apply(this.i.cursor,arguments),this},children:function(t){return this.chain(this.i.cursor.children(t))},parent:function(t){return this.chain(this.i.cursor.parent(t))},find:function(t){for(var e,n,r=this.i.cursor.chain(),i=t.reset(),s=this.helpers.queryInterface,a=s.shared.segments,o=a.matchAnyAndNone,c=a.goDescend,h=function(t){c=t},u=function(t){o=t},f=function(t){i=t};i=t.next();)if(i.call||(s.isCombination(i)?function(t){t.apply({setMatcher:u,setDirective:h,setSegment:f})}(i):s.isDirective(i)?h(i):s.isMatcher(i)&&u(i)),console.log("####",""+i,""+o,""+c),i.call)if(c===a.goDescend)if(o===a.matchAnyAndNone){n=r.children(),r.empty();do{(e=n.filter(i)).length()&&r.add(e),n=n.children()}while(n.length())}else o===a.matchNext&&(r=r.children(i));else if(c===a.goAscend)if(o===a.matchAnyAndNone){n=r.parent(),r.empty();do{(e=n.filter(i)).length()&&r.add(e),n=n.parent()}while(n.length())}else o===a.matchNext&&(r=r.parent(i));return this.chain(r)},get:function(t){return this.i.cursor.get.apply(this.i.cursor,arguments)},log:function(){return console.log(this.get()),this},getCursor:function(){return this.i.cursor}}),r.simpleQuery=r.queryInterface.extend({process:function(t){var e=[];"/"!=t[0]&&t.unshift("**");for(var n=0,r=t,i=r.length;n<i;n++)this.handleSegment(r[n],e);return e},handleSegment:function(t,e){switch(t){case"**":e.push(this.shared.segments.matchAnyAndNone);break;case"*":e.push(this.shared.segments.matchAny);break;case"/":e.push(this.shared.segments.matchNext);break;case"..":e.push(this.shared.segments.matchParent),e.push(this.shared.segments.goDescend);break;case"...":e.push(this.shared.segments.matchAncestor);break;default:switch(!0){case"@"==t.charAt(0):break;default:var n=function(e,n,r){return n===t};n.toString=function(){return"[SimpleQuery Match "+t+"]"},e.push(n),e.push(this.shared.segments.matchNext),e.push(this.shared.segments.goDescend)}}}}),r.dataHandlers.add("obj",1e3,{validation:function(t){return"object"==typeof t.get()&&1},filter:function(t,e){return e(t.get(),t.getKey(),t.getParent())},hasAttribute:function(t,e,n){},attribute:function(t,e,n){},hasChildren:function(t){return!!t.test(e.object,e.array)&&Object.keys(t.get()).length},children:function(t,n){if(t.test(e.object,e.array)){var r,i,s,a=t.get(),o=Object.keys(a),c=o.length,h=[];for(r=0;r<c;r++)s=a[i=o[r]],n&&!n(s,i)||h.push(t.joinChild(i,s));return h}return t.test(e.primitive),[]},hasParent:function(t){return!!t.getParent()},parent:function(t){return t.getParent()},needsResolving:function(){},resolve:function(){},processParents:function(){},processChildren:function(){}}),r.dataHandlers.add("dom",500,{validation:function(t){var e=t.get();return e&&e.nodeName?1:0},matchKey:function(){},matchValue:function(){},matchAttr:function(){},hasChildren:function(){},children:function(){},filter:function(){},hasParent:function(){},parent:function(){},needsResolving:function(){},resolve:function(){},processParents:function(){},processChildren:function(){}}),r.objNav=r().config().dataHandlers("obj").disallowDuplicates().endConfig(),t.intrepid=r});